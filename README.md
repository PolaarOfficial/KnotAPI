**This is a research project done by Alec Rulev**


# Purpose: Create an automated way to make a purchase on Amazon from signing in to checking out
This can possibly be used a case study for agentic shopping


Prerequisites:
- Basic Solution
--Create an amazon account for testing
- MFA Solution
--Create an amazon account for testing
--Create a VOIP phone number with an API access (Using TWILIO in this case)


## 1) BASIC SOLUTION

Creating an amazon account does not require much, and the security level is relatively basic. Realistically, most Amazon clients utilize MFA for signin, but this particular solution provides a good guideline of how to 
-  login 
- search for an item 
- add an item to cart, and 
-  checkout.

Leveraging playwright for this was done for familiarity purposes, as well its debugging utility and speed. 

Initially I created a few Page Object Models to reflect the relevant locators and functionalities I would require on each page which are as follows:
Home Page,
Search Result Page,
Cart Page,
Checkout Page.

Some extra pages were included to handle extra features provided by Amazon, such as purchasing or declining an Amazon Prime membership.

[Amazon E2E Tests](/tests/AmazonE2E.spec.ts)


## 2) MFA Solution

This solution was worked on first, until some roadblocks were hit, which resulted in the implementation of the basic solution. Lets assume that the set up is the same for MFA solution as it was for the basic solution. 

In the MFA solution, I am working with the problem of obtaining an OTP code generated by Amazon when a user attempts to login with 2FA enabled with their phone. In order to automate this process, I can leverage some tools such as Twilio, which provide virtual phone numbers, as well as an API to poll the phone numbers for their messages. 
>**Note**: OTP codes from Amazon arrive by short code message, and that requires a paid account on Twilio as well as an approved ticket for your virtual number to accept these messages. Currently, I am waiting for approval from Twilio's Customer Service, though there is chance Amazon might not allow VOIP phones to accept OTP codes.
>**Update** OTP codes are redacted by Twilio, I will be submitting a request ticket to support

An API that Twilio provides is as following to receive messages from the phone on your account: https://www.twilio.com/docs/messaging/api/message-resource#read-multiple-message-resources

Since I am not doing anything else with Twilio, other than polling for the messages, this is all that is necessary, and can be done by request, with no additional set up.

I can then pull in the OTP from GET request, and then leverage it in our login steps, in order to proceed with the Amazon shopping experience.

**Update**

**09/21/2025** Testing Twilio's Functionality<br>
I finally got to utilize Twilio's messaging functionality. But of course, there was a hiccup. Checking the messaging logs, I have found out that now I am able to receive messages from Amazon's 2FA! Unfortunately, the message I saw was as following: ```**is your Amazon OTP**``` which led to the following error code documentation: https://www.twilio.com/docs/api/errors/30038
> Twilio has determined that the body of this message contains a One-Time Passcode (OTP). In order to prevent the abuse of Twilio numbers, Twilio does not generally allow receiving OTP messages. The passcode content has been redacted and the message failed.
Fantastic... I will contact support.

**09/21/2025** Twilio requests confirmation of their short code abilities:
>However, we have recently added the ability to enable long code phone numbers on your Twilio account to receive these messages. I can help enable this, but first we have to get your consent and acknowledgement of these key details:
>>This feature, when enabled, will cause your account to receive incoming messages from short code numbers. The setting is account-wide and will affect all the long code numbers that belong to your Twilio account.
>>Short code numbers can only reach numbers from the same country as the short code. Therefore, you must ensure you're using a Twilio number from the same country as the short code, in order to receive messages. For example, if you are trying to receive messages from a Canada short code, you will need to use a Canada Twilio number.
>>Twilio cannot guarantee that every short code will be able to reach your Twilio number, even if the Twilio number is from the same country as the short code. There may be cases where a short code carrier does not have reach to Twilio; certain short code providers cannot reach some VoIP platforms. Some companies may also choose not to send to VoIP platforms. This is common with OTP messages from larger companies such as Apple, Microsoft, Google, Facebook, and WhatsApp.
>>You will not be able to send outbound messages from your Twilio numbers to short codes.

>Lastly, we need to get your confirmation that you have read and understand the following opt-out limitations with this feature from our legal team

I have confirmed.



## Usage with AGENTIC Shoppers
Current Idea:
See if it is possible to automate the deep link shopping flow:
- Create a deeplink to some random amazon product
- Hit the API link within the deeplink reference
- Leverage Playwright to go through the purchase process to simulate the normal human flow

Further research required:
Deep Link
https://developer.amazon.com/docs/reports-promo/deeplink-to-the-amazon-client.html
# Product Search API
**https://developer-docs.amazon.com/amazon-business/docs/product-search-api-v1-reference**
It looks like the Product Search API is not business specific, and will return values from the general market.

Here is an example search based off the 'Try it Out' functionality on the following page:
```
import amazonBusiness from '@api/amazon-business';
amazonBusiness.searchProductsRequest({keywords: 'laptop', productRegion: 'US', locale: 'en_US'})
  .then(({ data }) => console.log(data))
  .catch(err => console.error(err));
```

https://webservices.amazon.com/paapi5/documentation/search-items.html

The request provided a massive response, with both non-business specific products, but also further refinement strings which can be leveraged by the agentic shopper to make a personalized suggestion to the shopper.

An example of the laptop returned is here: https://www.amazon.com/dp/B0947BJ67M?ref_=ab_psdp&th=1

I decided to not incorporate a WireMock server due to time, so I copied the json response from the API call on Amazon's Documentation page, and tried to purchase the first product retrieved through the UI, as I did in previous examples above.

Few hicuups: when you get redirected to the url, and signin after attempting to purchase it, you run into a 5XX error, which is easily resolved by using the UI buttons to go back to the homepage. With the new page, you are logged in, with item in cart.

This can be seen in the tests located in [Amazon Product Search API Tests](/tests/AmazonProductSearchAPI.spec.ts)

Checkout Session API
https://developer.amazon.com/docs/amazon-pay-api-v2/checkout-session.html

https://www.skilldrick.co.uk/2010/02/amazon-product-information-via-amazon-web-services/
https://stackoverflow.com/questions/1595624/amazon-products-api-looking-for-basic-overview-and-information

